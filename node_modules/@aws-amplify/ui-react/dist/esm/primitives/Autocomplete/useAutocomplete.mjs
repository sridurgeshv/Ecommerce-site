import*as e from"react";import{isFunction as t}from"@aws-amplify/ui";import{ARROW_UP as o,ARROW_DOWN as n,ENTER_KEY as l,ESCAPE_KEY as s}from"../shared/constants.mjs";import{strHasLength as i}from"../shared/utils.mjs";import{useStableId as a}from"../utils/useStableId.mjs";const u=new Set([n,o,l,s]),c=({defaultValue:c="",value:r,options:d,optionFilter:m,onBlur:f,onChange:p,onClear:h,onClick:g,onSelect:b,onSubmit:v})=>{var C;const I=void 0!==r,[k,w]=e.useState(c),O=I?r:k,[B,E]=e.useState(!1),[y,S]=e.useState(null),T=t(m),H=e.useMemo((()=>{var e;const t=T?e=>m(e,O):e=>{const{label:t}=e;return null==t?void 0:t.toLocaleLowerCase().includes(null==O?void 0:O.toLocaleLowerCase())};return null!==(e=null==d?void 0:d.filter(t))&&void 0!==e?e:[]}),[O,m,T,d]),L=a(),M=a(),V=a(),j=a(),x=H.findIndex((e=>e===y)),D=null!==(C=null==y?void 0:y.id)&&void 0!==C?C:-1!==x?`${j}-option-${x}`:void 0,F=e.useCallback((e=>{E(!1),S(null),t(f)&&f(e)}),[f]),R=e.useCallback((e=>{S(null),E(!0),I||w(e.target.value),t(p)&&p(e)}),[I,p]),$=e.useCallback((()=>{I||w(""),t(h)&&h()}),[I,h]),A=e.useCallback((e=>{E(!0),t(g)&&g(e)}),[g]);return e.useEffect((()=>{const e=document.getElementById(L),t=document.getElementById(V);if(t&&B&&e){const{bottom:o}=t.getBoundingClientRect(),{offsetParent:n,offsetTop:l}=e;n===document.body&&o>document.documentElement.clientHeight&&window.scrollTo({top:Math.min(o-document.documentElement.clientHeight+window.scrollY+20,l),behavior:"smooth"})}}),[L,B,V]),e.useEffect((()=>{const e=document.getElementById(M),t=i(D)?document.getElementById(D):null;if(t&&e){const{scrollTop:o,clientHeight:n}=e,{offsetHeight:l,offsetTop:s}=t,{top:i,bottom:a}=t.getBoundingClientRect();o>s&&(e.scrollTop=s),o+n<s+l&&(e.scrollTop=s+l-n),(i<0||a>document.documentElement.clientHeight)&&t.scrollIntoView({behavior:"smooth",block:"nearest"})}}),[D,M]),{activeOptionId:D,autocompleteId:L,composedValue:O,filteredOptions:H,handleOnBlur:F,handleOnClear:$,handleOnClick:A,handleOnChange:R,handleOnKeyDown:e=>{const{key:i}=e;if(u.has(i))switch(e.preventDefault(),i){case s:B?(E(!1),S(null)):$();break;case l:if(y){const{label:e}=y;I||w(e),t(b)&&b(y)}else t(v)&&v(O);E(!1),S(null);break;case n:{if(H.length<=0)return;E(!0);const e=x>=H.length-1?0:x+1;S(H[e]);break}case o:{if(H.length<=0)return;E(!0);const e=x<=0?H.length-1:x-1;S(H[e])}}},isControlled:I,isCustomFiltering:T,isMenuOpen:B,listboxId:M,menuId:V,optionBaseId:j,setActiveOption:S,setIsMenuOpen:E,setInternalValue:w}};export{c as useAutocomplete};

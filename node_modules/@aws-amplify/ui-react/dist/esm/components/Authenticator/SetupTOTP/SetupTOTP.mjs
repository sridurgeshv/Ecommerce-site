import{__awaiter as e}from"tslib";import t from"qrcode";import*as o from"react";import{Logger as r}from"aws-amplify";import{authenticatorTextUtil as a,getTotpCodeURL as m}from"@aws-amplify/ui";import{Flex as i}from"../../../primitives/Flex/Flex.mjs";import{Heading as n}from"../../../primitives/Heading/Heading.mjs";import{useAuthenticator as l}from"@aws-amplify/ui-react-core";import{useCustomComponents as s}from"../hooks/useCustomComponents/useCustomComponents.mjs";import{useFormHandlers as c}from"../hooks/useFormHandlers/useFormHandlers.mjs";import{ConfirmSignInFooter as p}from"../shared/ConfirmSignInFooter.mjs";import{RemoteErrorMessage as d}from"../shared/RemoteErrorMessage.mjs";import{FormFields as u}from"../shared/FormFields.mjs";import{RouteContainer as f}from"../RouteContainer/RouteContainer.mjs";const g=new r("SetupTOTP-logger"),{getSetupTOTPText:h,getCopiedText:C,getLoadingText:E}=a,v=({className:r,variation:a})=>{var n;const{totpSecretCode:h,isPending:y,user:H,QRFields:w}=l((e=>[e.isPending,e.totpSecretCode])),{handleChange:S,handleSubmit:F}=c(),{components:{SetupTOTP:{Header:T=v.Header,Footer:x=v.Footer}}}=s(),[j,V]=o.useState(!0),[b,P]=o.useState(),[R,k]=o.useState("COPY"),{totpIssuer:L="AWSCognito",totpUsername:M=(null==H?void 0:H.username)}=null!==(n=w)&&void 0!==n?n:{},O=o.useCallback((()=>e(void 0,void 0,void 0,(function*(){try{const e=m(L,M,h),o=yield t.toDataURL(e);P(o)}catch(e){g.error(e)}finally{V(!1)}}))),[L,M,h]);o.useEffect((()=>{b||O()}),[O,b]);return o.createElement(f,{className:r,variation:a},o.createElement("form",{"data-amplify-form":"","data-amplify-authenticator-setup-totp":"",method:"post",onChange:S,onSubmit:F},o.createElement(i,{as:"fieldset",direction:"column",isDisabled:y},o.createElement(T,null),o.createElement(i,{direction:"column"},j?o.createElement("p",null,E(),"â€¦"):o.createElement("img",{"data-amplify-qrcode":!0,src:b,alt:"qr code",width:"228",height:"228"}),o.createElement(i,{"data-amplify-copy":!0},o.createElement("div",null,h),o.createElement(i,{"data-amplify-copy-svg":!0,onClick:()=>{navigator.clipboard.writeText(h),k(C())}},o.createElement("div",{"data-amplify-copy-tooltip":!0},R),o.createElement("svg",{width:"24",height:"24",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg"},o.createElement("path",{d:"M16 1H4C2.9 1 2 1.9 2 3V17H4V3H16V1ZM15 5H8C6.9 5 6.01 5.9 6.01 7L6 21C6 22.1 6.89 23 7.99 23H19C20.1 23 21 22.1 21 21V11L15 5ZM8 21V7H14V12H19V21H8Z"})))),o.createElement(u,null),o.createElement(d,null)),o.createElement(p,null),o.createElement(x,null))))};v.Header=function(){return o.createElement(n,{level:3},h())},v.Footer=function(){return null};export{v as SetupTOTP};
